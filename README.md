# Nx Nest Docker Dev Environment

<a alt="Nx logo" href="https://nx.dev" target="_blank" rel="noreferrer"><img src="https://raw.githubusercontent.com/nrwl/nx/master/images/nx-logo.png" width="45"></a>

✨ **This workspace has been generated by [Nx, Smart Monorepos · Fast CI.](https://nx.dev) and after carefully polished with stack overflow ** ✨

## Pre requirements 

1. Docker Compose version 2.22 and later

## Main Idea

As you can see from Pre requirements we really need only Docker for our local development. In future all that we need to start our microservices localy just run one command. For now we still should provide manually environment variables before run containers, but in future we will add doppler to nx build step and we will no longer depends on existance of these variables in .env file.
This means that we no longer need manually to setup projects one by one to develop localy. 

## Main development proccess 

1. Copy environment variables from .env.basic -> .env
2. Run `docker compose watch`
3. Make coffee during building images (actually only one image, because for second image docker cache will be used) 
4. Start implement your features

## Detailes of implementation and Workarounds


1. To test changes you can use http request to http://localhost:3000/api and then change return in `apps/data/src/app/app.service.ts` 
    `watch` mode will pick up changes and rebuild needed containers. Important part here - give it at least few second - even locally nx daemon require few sec to rerun nest microservice.

2. In current project I use nx version 18.1.3 but project.json for each apps configured in more oldschool way, that's why pay attention
    to `build` step and `webpack.config.js` file, don't forgot to replace generated with `NX Console`(for example if you want to add one more app) webpack config as I did for gateway and data apps. If you wonder why - long story short - when you switch from usage `@nx/webpack/plugin` to usage `@nx/webpack:webpack` as executor nx daemon will recognize changes but webpack will not rebuild project and as result nest microservice won't restart. If you know how to setup nx :build target with `@nx/webpack/plugin` and provide same functionality as current config - feel free to create PR with changes


